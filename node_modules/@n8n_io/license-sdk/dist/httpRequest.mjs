import{fetch as a,getGlobalDispatcher as c,setGlobalDispatcher as p,Dispatcher as u,ProxyAgent as h}from"undici";import{URL as l}from"url";var m=Object.fromEntries(["http","https"].map(t=>{let r=process.env[`${t}_proxy`];return r?[`${t}:`,new h(r)]:[]})),y=(process.env.no_proxy??"").split(",").map(t=>t.trim()),f=c();p(new class extends u{dispatch(t,r){if(t.origin){let{host:s,protocol:n}=typeof t.origin=="string"?new l(t.origin):t.origin;if(!y.some(e=>e.startsWith(".")?s.endsWith(e):s===e)){let e=m[n];e&&e.dispatch(t,r)}}return f.dispatch(t,r)}});async function g(t,r,s={}){let n=new AbortController,e=setTimeout(()=>{n.abort()},s.timeoutInMs??3e4);try{let o=await a(t,{method:"post",body:JSON.stringify(r),headers:{"Content-Type":"application/json"},signal:n.signal}),i=await o.json();return{status:o.status,data:i}}catch(o){throw new Error("Connection Error",{cause:o})}finally{clearTimeout(e)}}var w={postRequest:g};export{w as default,g as postRequest};
//# sourceMappingURL=httpRequest.mjs.map